<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackVip Casino | Ultra Premium Definitive Edition</title>
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Poppins:wght@300;400;600;800&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ============================================================
           SISTEMA DE VARIABLES Y DISE√ëO VIP
           ============================================================ */
        :root {
            --gold: #c5a059;
            --gold-light: #e9d5a3;
            --gold-dark: #8a6d3b;
            --purple-vip: #4b0082;
            --black-bg: #050505;
            --dark-gray: #121212;
            --white: #ffffff;
            --red-casino: #d32f2f;
            --green-casino: #2e7d32;
            --ocre: #8b4513;
            --shadow-gold: rgba(197, 160, 89, 0.3);
            --neon-glow: 0 0 15px var(--gold);
        }

        /* ============================================================
           ESTILOS BASE Y SCROLLBAR PREMIUM
           ============================================================ */
        * { box-sizing: border-box; }
        
        body { 
            background-color: var(--black-bg); 
            color: var(--white); 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            background-image: radial-gradient(circle at center, #1a0033 0%, #050505 100%);
            min-height: 100vh; 
            overflow-x: hidden;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: var(--gold-dark); border-radius: 10px; }

        h1, h2, h3, .logo { 
            font-family: 'Cinzel', serif; 
            letter-spacing: 3px; 
            text-transform: uppercase; 
            color: var(--gold);
            margin-top: 0;
        }

        /* ============================================================
           PANTALLA DE ACCESO (AUTHENTICATION)
           ============================================================ */
        #auth-container { 
            position: fixed; 
            inset: 0; 
            background: var(--black-bg); 
            z-index: 9000; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            background-image: url('https://www.transparenttextures.com/patterns/dark-matter.png');
        }

        .auth-box { 
            background: rgba(10, 10, 10, 0.98); 
            padding: 60px; 
            border-radius: 20px; 
            border: 1px solid var(--gold); 
            text-align: center; 
            width: 450px; 
            box-shadow: 0 0 80px rgba(0,0,0,1), 0 0 30px var(--shadow-gold);
            animation: authFadeIn 1.2s ease;
        }

        @keyframes authFadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        .auth-box input { 
            width: 100%; 
            padding: 18px; 
            margin: 15px 0; 
            border: none; 
            border-bottom: 2px solid var(--gold);
            background: rgba(255, 255, 255, 0.02); 
            color: #fff; 
            outline: none; 
            font-size: 1rem;
            transition: 0.4s;
            text-align: center;
        }

        .auth-box input:focus { background: rgba(197, 160, 89, 0.1); border-bottom-color: var(--gold-light); }

        /* ============================================================
           HEADER Y ESTADO DE FONDOS
           ============================================================ */
        header { 
            display: none; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0 50px;
            height: 90px;
            background: rgba(0, 0, 0, 0.95); 
            border-bottom: 1px solid var(--gold);
            position: sticky; 
            top: 0; 
            z-index: 2000; 
            backdrop-filter: blur(25px);
        }

        .balance-card { 
            background: linear-gradient(135deg, var(--gold-dark), var(--gold), var(--gold-dark)); 
            color: black; 
            padding: 12px 40px; 
            border-radius: 8px; 
            font-weight: 900; 
            cursor: pointer;
            box-shadow: 0 0 20px rgba(197, 160, 89, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: 0.3s;
        }

        .balance-card:hover { transform: translateY(-3px); box-shadow: 0 10px 30px var(--shadow-gold); }
        .balance-card span#bal-val { font-size: 1.4rem; font-family: 'Orbitron', sans-serif; }

        /* ============================================================
           LOBBY Y CARTAS DE JUEGO (GRID)
           ============================================================ */
        #main-content { 
            display: none; 
            padding: 60px 5%; 
            flex-direction: column; 
            align-items: center; 
        }

        .lobby { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 40px; 
            width: 100%; 
            max-width: 1300px; 
        }

        .game-card { 
            background: #080808; 
            position: relative; 
            border-radius: 15px; 
            overflow: hidden;
            cursor: pointer; 
            transition: 0.6s cubic-bezier(0.165, 0.84, 0.44, 1); 
            border: 1px solid #1a1a1a; 
            height: 250px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.8);
        }

        .game-card:hover { 
            transform: translateY(-20px); 
            border-color: var(--gold); 
            box-shadow: 0 20px 60px rgba(0,0,0,0.9), 0 0 20px var(--shadow-gold); 
        }

        .game-card img { width: 100%; height: 100%; object-fit: cover; opacity: 0.4; transition: 0.8s; }
        .game-card:hover img { opacity: 0.85; transform: scale(1.1); }

        .game-card h3 { 
            position: absolute; 
            bottom: 30px; 
            left: 30px; 
            font-size: 1.8rem; 
            text-shadow: 2px 2px 10px black; 
            z-index: 10;
        }

        /* ============================================================
           SISTEMA DE VENTANAS MODALES
           ============================================================ */
        .modal { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.96); 
            z-index: 5000; 
            align-items: center; 
            justify-content: center; 
            backdrop-filter: blur(12px);
        }

        .game-window { 
            background: #000; 
            width: 95%; 
            max-width: 1000px; 
            padding: 60px; 
            border: 1px solid var(--gold); 
            position: relative; 
            border-radius: 20px;
            max-height: 95vh;
            overflow-y: auto;
            box-shadow: 0 0 100px rgba(0,0,0,1);
        }

        .close-modal { position: absolute; top: 30px; right: 30px; color: var(--gold); font-size: 3.5rem; cursor: pointer; line-height: 1; transition: 0.3s; }
        .close-modal:hover { color: #fff; transform: rotate(90deg); }

        /* ============================================================
           RULETA MEJORADA (PRECISI√ìN T√âCNICA)
           ============================================================ */
        .wheel-container { 
            position: relative; 
            width: 400px; 
            height: 400px; 
            margin: 40px auto; 
            perspective: 1000px;
        }

        #r-wheel { 
            width: 100%; 
            height: 100%; 
            border-radius: 50%; 
            border: 18px solid #1a1a1a; 
            box-shadow: 0 0 60px rgba(0,0,0,1), inset 0 0 40px rgba(0,0,0,0.8);
            transition: 8s cubic-bezier(0.15, 0, 0.05, 1); 
            background: conic-gradient(
                #2e7d32 0deg 9.73deg,
                #d32f2f 9.73deg 19.46deg, #111 19.46deg 29.19deg, #d32f2f 29.19deg 38.92deg, #111 38.92deg 48.65deg,
                #d32f2f 48.65deg 58.38deg, #111 58.38deg 68.11deg, #d32f2f 68.11deg 77.84deg, #111 77.84deg 87.57deg,
                #d32f2f 87.57deg 97.3deg, #111 97.3deg 107.03deg, #d32f2f 107.03deg 116.76deg, #111 116.76deg 126.49deg,
                #d32f2f 126.49deg 136.22deg, #111 136.22deg 145.95deg, #d32f2f 145.95deg 155.68deg, #111 155.68deg 165.41deg,
                #d32f2f 165.41deg 175.14deg, #111 175.14deg 184.87deg, #d32f2f 184.87deg 194.6deg, #111 194.6deg 204.33deg,
                #d32f2f 204.33deg 214.06deg, #111 214.06deg 223.79deg, #d32f2f 223.79deg 233.52deg, #111 233.52deg 243.25deg,
                #d32f2f 243.25deg 252.98deg, #111 252.98deg 262.71deg, #d32f2f 262.71deg 272.44deg, #111 272.44deg 282.17deg,
                #d32f2f 282.17deg 291.9deg, #111 291.9deg 301.63deg, #d32f2f 301.63deg 311.36deg, #111 311.36deg 321.09deg,
                #d32f2f 321.09deg 330.82deg, #111 330.82deg 340.55deg, #d32f2f 340.55deg 350.28deg, #111 350.28deg 360deg
            );
        }

        .wheel-pointer { 
            position: absolute; 
            top: -20px; 
            left: 50%; 
            transform: translateX(-50%);
            width: 0; 
            height: 0; 
            border-left: 25px solid transparent; 
            border-right: 25px solid transparent;
            border-top: 50px solid var(--gold); 
            z-index: 100; 
            filter: drop-shadow(0 0 15px black);
        }

        /* ============================================================
           ESTILOS DE BOTONES Y MENSAJES
           ============================================================ */
        .status-msg { 
            font-size: 1.8rem; 
            color: var(--gold); 
            margin-bottom: 35px; 
            font-weight: 800; 
            text-align: center; 
            text-transform: uppercase; 
            min-height: 45px; 
            letter-spacing: 3px;
        }

        .win-anim { color: var(--green-casino) !important; text-shadow: 0 0 25px var(--green-casino); animation: pulse 0.5s infinite alternate; }
        .lose-anim { color: var(--red-casino) !important; text-shadow: 0 0 25px var(--red-casino); }

        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }

        .btn { 
            padding: 20px 40px; 
            border: none; 
            cursor: pointer; 
            font-family: 'Cinzel'; 
            font-weight: 900; 
            transition: 0.3s; 
            margin: 10px; 
            border-radius: 8px; 
            text-transform: uppercase; 
            font-size: 1.1rem;
            letter-spacing: 2px;
        }

        .btn-gold { background: linear-gradient(to bottom, var(--gold-light), var(--gold)); color: black; box-shadow: 0 6px 0 var(--gold-dark); }
        .btn-gold:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-gold:active { transform: translateY(4px); box-shadow: none; }
        .btn-gold:disabled { filter: grayscale(1); cursor: not-allowed; opacity: 0.6; }

        .btn-outline { background: transparent; border: 2px solid var(--gold); color: var(--gold); }
        .btn-outline:hover { background: var(--gold); color: black; }

        /* ============================================================
           CAJERO Y HISTORIAL (TABLES)
           ============================================================ */
        .bank-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 30px; }
        .bank-card { background: #0a0a0a; padding: 40px; border-radius: 15px; border: 1px solid #222; border-top: 5px solid var(--gold); }
        .history-table { width: 100%; border-collapse: collapse; margin-top: 35px; color: #aaa; font-size: 0.9rem; }
        .history-table th { background: #111; color: var(--gold); padding: 18px; text-transform: uppercase; border-bottom: 2px solid var(--gold); text-align: center; }
        .history-table td { padding: 15px; text-align: center; border-bottom: 1px solid #1a1a1a; }

        /* Estilo para las cartas de Blackjack / Poker / Truco */
        .card-container {
            perspective: 1000px;
        }
        .casino-card {
            width: 85px; height: 120px;
            background: white; color: black;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 2.2rem;
            border: 3px solid var(--gold);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
            animation: dealCard 0.5s ease-out;
            position: relative;
        }
        @keyframes dealCard { from { transform: translateY(-200px) rotate(20deg); opacity: 0; } to { transform: translateY(0) rotate(0); opacity: 1; } }
        
        /* Poker Specific Styles */
        .poker-deck { display: flex; justify-content: center; gap: 10px; margin: 20px 0; min-height: 130px; flex-wrap: wrap; }
        .poker-pot { font-family: 'Orbitron'; color: var(--gold); font-size: 1.5rem; text-align: center; margin: 10px 0; }

        /* ============================================================
           ESTILOS A√ëADIDOS: TRUCO VENEZOLANO
           ============================================================ */
        .truco-board { background: #0a4d28; border: 10px solid var(--ocre); border-radius: 50px; padding: 30px; position: relative; min-height: 500px; box-shadow: inset 0 0 100px #000; margin-top: 20px; }
        .truco-score { position: absolute; right: 20px; top: 20px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border: 1px solid var(--gold); font-family: 'Orbitron'; color: var(--gold); font-size: 0.9rem; }
        .vira-area { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); text-align: center; }
        .hand-area { display: flex; justify-content: center; gap: 15px; margin: 20px 0; min-height: 130px; }
        .played-area { display: flex; justify-content: center; align-items: center; gap: 50px; height: 160px; border: 1px dashed rgba(255,255,255,0.1); border-radius: 20px; margin: 20px 0; }
    </style>
</head>
<body>

    <div id="auth-container">
        <div class="auth-box">
            <h1 id="auth-main-title">BLACK VIP CASINO</h1>
            <p style="color:var(--gold); font-size: 0.8rem; letter-spacing: 5px; margin-bottom: 25px;">MEMBERSHIP REQUIRED</p>
            <input type="text" id="user-in" placeholder="IDENTIFICADOR DE SOCIO">
            <input type="password" id="pass-in" placeholder="CLAVE CRIPTOGR√ÅFICA">
            <div id="reg-fields" style="display:none">
                <input type="text" id="bank-in" placeholder="CUENTA BANCARIA / PAGO M√ìVIL">
            </div>
            <button class="btn btn-gold" style="width:100%; margin-top:20px;" onclick="processAuth()">ENTRAR AL CLUB</button>
            <p style="font-size: 0.85rem; margin-top:35px; cursor:pointer; color:var(--gold-light); font-weight: 600;" onclick="toggleAuth()">SOLICITAR INGRESO AL CLUB</p>
        </div>
    </div>

    <header id="vip-header">
        <div class="logo" style="font-size: 1.8rem; font-weight: 900;">BLACK VIP</div>
        <div class="balance-card" onclick="openBank()">
            <span style="font-size:0.65rem; display:block; opacity: 0.9; letter-spacing: 1px;">CR√âDITOS DISPONIBLES</span>
            <div><span id="bal-val">0</span> <small style="font-size: 0.8rem;">BC</small></div>
        </div>
        <div style="color:var(--gold); cursor:pointer; font-weight:700; font-size:0.9rem; border-bottom: 2px solid var(--gold); padding-bottom: 5px;" onclick="location.reload()">ABANDONAR CLUB</div>
    </header>

    <div id="main-content">
        <div class="lobby">
            <div class="game-card" onclick="openGame('ruleta')">
                <img src="https://images.unsplash.com/photo-1606167668584-78701c57f13d?w=800">
                <h3>RULETA ROYAL</h3>
            </div>
            <div class="game-card" onclick="openGame('truco')">
                <img src="https://images.unsplash.com/photo-1511193311914-0346f16efe90?w=800">
                <h3>TRUCO VENEZOLANO</h3>
            </div>
            <div class="game-card" onclick="openGame('blackjack')">
                <img src="https://images.unsplash.com/photo-1544161515-4af6b1d8e159?w=800">
                <h3>BLACKJACK 21</h3>
            </div>
            <div class="game-card" onclick="openGame('poker')">
                <img src="https://images.unsplash.com/photo-1541252260730-0412e3e2104e?w=800">
                <h3>POKER TEXAS HOLDEM</h3>
            </div>
            <div class="game-card" onclick="openGame('aviator')">
                <img src="https://images.unsplash.com/photo-1559136555-9303baea8ebd?w=800">
                <h3>AVIATOR PRO</h3>
            </div>
            <div class="game-card" onclick="openGame('slots')">
                <img src="https://images.unsplash.com/photo-1596838132731-3301c3fd4317?w=800">
                <h3>LUCKY SLOTS</h3>
            </div>
            <div class="game-card" onclick="openGame('mines')">
                <img src="https://images.unsplash.com/photo-1614028674026-a65e31bfd27c?w=800">
                <h3>MINAS VIP</h3>
            </div>
            <div class="game-card" onclick="openBank()">
                <img src="https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=800">
                <h3>CAJERO VIP</h3>
            </div>
        </div>
    </div>

    <div id="modal-truco" class="modal">
        <div class="game-window" style="max-width: 1100px;">
            <span class="close-modal" onclick="closeAll()">√ó</span>
            <h2>TRUCO VENEZOLANO</h2>
            <div id="t-status" class="status-msg">¬°HAGAN SUS APUESTAS!</div>
            
            <div class="truco-board">
                <div class="truco-score">
                    NOSOTROS: <span id="t-score-p">0</span>/12<br>
                    ELLOS: <span id="t-score-c">0</span>/12
                </div>

                <div class="vira-area">
                    <div style="font-size:0.7rem; color:var(--gold-light); margin-bottom:5px;">VIRA</div>
                    <div id="t-vira" class="casino-card" style="cursor:default">?</div>
                </div>

                <div id="t-hand-c" class="hand-area"></div>

                <div class="played-area">
                    <div id="t-played-c"></div>
                    <div id="t-played-p"></div>
                </div>

                <div id="t-hand-p" class="hand-area"></div>
            </div>

            <div style="text-align:center; margin-top:20px;">
                <button id="t-start" class="btn btn-gold" onclick="startTruco()">APOSTAR 100 BC</button>
                <button id="t-btn-truco" class="btn btn-outline" onclick="cantar('truco')" disabled>¬°TRUCO!</button>
                <button id="t-btn-envido" class="btn btn-outline" onclick="cantar('envido')" disabled>ENVIDO</button>
                <button id="t-btn-flor" class="btn btn-outline" onclick="cantar('flor')" disabled>FLOR</button>
                <button id="t-btn-mazo" class="btn btn-outline" onclick="irseAlMazo()" disabled style="color:var(--red-casino)">MAZO</button>
            </div>
        </div>
    </div>

    <div id="modal-poker" class="modal">
        <div class="game-window">
            <span class="close-modal" onclick="closeAll()">√ó</span>
            <h2>POKER TEXAS HOLDEM</h2>
            <div id="p-status" class="status-msg">BIENVENIDO A LA MESA</div>
            
            <div id="poker-table" style="background:#0a3d1e; padding:30px; border:10px solid var(--ocre); border-radius:100px; box-shadow: inset 0 0 100px black;">
                <div class="poker-pot">BOTE: <span id="p-pot">0</span> BC</div>
                
                <div style="text-align:center; color:rgba(255,255,255,0.3); font-size:0.7rem;">RIVAL</div>
                <div id="p-rival-hand" class="poker-deck"></div>
                
                <div style="text-align:center; color:rgba(255,255,255,0.3); font-size:0.7rem;">MESA (COMMUNITY)</div>
                <div id="p-community" class="poker-deck"></div>
                
                <hr style="border:none; border-top:1px dashed rgba(255,255,255,0.1);">
                
                <div style="text-align:center; color:rgba(255,255,255,0.3); font-size:0.7rem;">TU MANO</div>
                <div id="p-player-hand" class="poker-deck"></div>
            </div>

            <div style="text-align:center; margin-top:30px;">
                <button id="p-start" class="btn btn-gold" onclick="startP()">ENTRAR (100 BC)</button>
                <button id="p-call" class="btn btn-outline" onclick="callP()" disabled>IGUALAR / PASAR</button>
                <button id="p-fold" class="btn btn-outline" onclick="foldP()" disabled style="border-color:var(--red-casino); color:var(--red-casino);">RETIRARSE</button>
            </div>
        </div>
    </div>

    <div id="modal-ruleta" class="modal">
        <div class="game-window">
            <span class="close-modal" onclick="closeAll()">√ó</span>
            <h2>RULETA ROYAL</h2>
            <div id="r-status" class="status-msg">HAGAN SUS APUESTAS</div>
            
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <div id="r-wheel"></div>
            </div>

            <div style="text-align:center; margin-top:50px;">
                <button id="r-btn-red" class="btn btn-gold" style="background:var(--red-casino); color:white; border:none;" onclick="playR('rojo')">APOSTAR ROJO (X2)</button>
                <button id="r-btn-black" class="btn btn-gold" style="background:#111; color:white; border:1px solid var(--gold);" onclick="playR('negro')">APOSTAR NEGRO (X2)</button>
            </div>
        </div>
    </div>

    <div id="modal-blackjack" class="modal">
        <div class="game-window">
            <span class="close-modal" onclick="closeAll()">√ó</span>
            <h2>BLACKJACK 21</h2>
            <div id="b-status" class="status-msg">ESPERANDO APUESTA</div>
            
            <div style="background:#0a3d1e; padding:50px; border:12px solid var(--ocre); border-radius:60px; box-shadow: inset 0 0 120px black;">
                <div style="text-align:center; color:rgba(255,255,255,0.4); font-size:0.9rem; margin-bottom:15px; font-weight: 800; letter-spacing: 2px;">BANQUERO</div>
                <div id="b-dealer" style="display:flex; justify-content:center; gap:20px; min-height:130px;"></div>
                <hr style="border:none; border-top:2px dashed rgba(255,255,255,0.1); margin:40px 0;">
                <div style="text-align:center; color:rgba(255,255,255,0.4); font-size:0.9rem; margin-bottom:15px; font-weight: 800; letter-spacing: 2px;">TU MANO</div>
                <div id="b-player" style="display:flex; justify-content:center; gap:20px; min-height:130px;"></div>
            </div>

            <div style="text-align:center; margin-top:50px;">
                <button id="b-start" class="btn btn-gold" onclick="startB()">APOSTAR 50 BC</button>
                <button id="b-hit" class="btn btn-outline" onclick="hitB()" disabled>PEDIR CARTA</button>
                <button id="b-stand" class="btn btn-outline" onclick="standB()" disabled>PLANTARSE</button>
            </div>
        </div>
    </div>

    <div id="modal-aviator" class="modal">
        <div class="game-window">
            <span class="close-modal" onclick="closeAll()">√ó</span>
            <h2>AVIATOR PRO</h2>
            <div id="c-status" class="status-msg">LISTO PARA EL DESPEGUE</div>
            <div id="c-mult" style="font-size:8rem; text-align:center; color:var(--white); font-weight:900; font-family:'Orbitron'; text-shadow: 0 0 40px var(--gold-dark); margin: 20px 0;">1.00x</div>
            <div style="text-align:center; margin-top:40px;">
                <button id="c-start" class="btn btn-gold" onclick="startC()">APOSTAR 100 BC</button>
                <button id="c-cash" class="btn btn-outline" onclick="cashC()" disabled>RETIRAR BC</button>
            </div>
        </div>
    </div>

    <div id="modal-slots" class="modal">
        <div class="game-window">
            <span class="close-modal" onclick="closeAll()">√ó</span>
            <h2>LUCKY SLOTS</h2>
            <div id="s-status" class="status-msg">POZO ACUMULADO: 500 BC</div>
            <div style="display:flex; justify-content:center; gap:25px; margin:60px 0;">
                <div id="sl1" class="casino-card" style="width:120px; height:160px; font-size:5rem;">üíé</div>
                <div id="sl2" class="casino-card" style="width:120px; height:160px; font-size:5rem;">üíé</div>
                <div id="sl3" class="casino-card" style="width:120px; height:160px; font-size:5rem;">üíé</div>
            </div>
            <div style="text-align:center;">
                <button id="s-spin" class="btn btn-gold" onclick="playS()">GIRAR (20 BC)</button>
            </div>
        </div>
    </div>

    <div id="modal-mines" class="modal">
        <div class="game-window">
            <span class="close-modal" onclick="closeAll()">√ó</span>
            <h2>MINAS VIP</h2>
            <div id="m-status" class="status-msg">CAMPO DE MINAS ACTIVO</div>
            <div id="m-grid" style="display:grid; grid-template-columns:repeat(5, 1fr); gap:15px; max-width:500px; margin:auto;"></div>
            <div style="text-align:center; margin-top:50px;">
                <button id="m-start" class="btn btn-gold" onclick="startM()">INICIAR (100 BC)</button>
                <button id="m-cash" class="btn btn-outline" onclick="cashM()" disabled>RETIRAR BOT√çN</button>
            </div>
        </div>
    </div>

    <div id="modal-bank" class="modal">
        <div class="game-window" style="max-width:1000px;">
            <span class="close-modal" onclick="closeAll()">√ó</span>
            <h2>CENTRO DE FONDOS VIP</h2>
            
            <div class="bank-grid">
                <div class="bank-card">
                    <h3 style="font-size:1.2rem; margin-top:0;">RECARGA DE CR√âDITOS</h3>
                    <p style="font-size:0.85rem; color:#888; margin-bottom: 20px;">Utilice los siguientes datos para su transferencia y notifique para la acreditaci√≥n inmediata.</p>
                    <div style="background:#000; padding:25px; border-radius:10px; font-size:0.9rem; border:1px solid #333; line-height: 2;">
                        <span style="color:var(--gold); font-weight: 800;">BANCO:</span> 0102 - BANCO DE VENEZUELA<br>
                        <span style="color:var(--gold); font-weight: 800;">TITULAR:</span> BLACK VIP CASINO GROUP<br>
                        <span style="color:var(--gold); font-weight: 800;">TEL√âFONO:</span> 0412-4209277<br>
                        <span style="color:var(--gold); font-weight: 800;">C.I / RIF:</span> 30.041.715
                    </div>
                    <button class="btn btn-gold" style="width:100%; margin-top:25px;" onclick="alert('Sistema de verificaci√≥n activado. Su saldo se actualizar√° tras la confirmaci√≥n de la red.')">NOTIFICAR TRANSFERENCIA</button>
                </div>

                <div class="bank-card">
                    <h3 style="font-size:1.2rem; margin-top:0;">RETIRO DE GANANCIAS</h3>
                    <p id="bank-info-display" style="font-size:0.85rem; color:var(--gold-light); font-weight:bold; margin-bottom: 15px;"></p>
                    <input type="number" id="wit-val" placeholder="CANTIDAD DE BC A RETIRAR" style="width:100%; padding:15px; background:rgba(0,0,0,0.5); border:1px solid #444; color:white; border-radius: 5px;">
                    <button class="btn btn-outline" style="width:100%; margin-top:25px;" onclick="processWithdraw()">SOLICITAR LIQUIDACI√ìN</button>
                </div>
            </div>

            <h3 style="margin-top:50px; font-size:1.2rem; border-left: 5px solid var(--gold); padding-left: 15px;">BIT√ÅCORA DE OPERACIONES RECIENTES</h3>
            <div style="max-height:350px; overflow-y:auto; border:1px solid #222; border-radius: 10px;">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>TIPO DE ACTIVIDAD</th>
                            <th>MONTO (BC)</th>
                            <th>ESTADO / RESULTADO</th>
                            <th>MARCA TEMPORAL</th>
                        </tr>
                    </thead>
                    <tbody id="hist-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
	<script>
    // 1. Configuraci√≥n de conexi√≥n con TU base de datos
    const SUPABASE_URL = 'https://fktwltpcooukzzvtazqn.supabase.co'; // Reemplaza con tu URL
    const SUPABASE_KEY = 'sb_publishable_qxEHBRTzpcDXTGWo6wTgNQ_ZR1TyXjk';       // Reemplaza con tu Key
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Variables globales que ya ten√≠as (d√©jalas debajo)
    let isReg = false;
    let balance = 1000; 
    // ... resto de tus variables
        /* ============================================================
           SISTEMA DE AUDIO INTEGRADO
           ============================================================ */
        const sounds = {
            card: new Audio('https://www.soundjay.com/buttons/button-16.mp3'),
            win: new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3'),
            lose: new Audio('https://www.soundjay.com/buttons/button-11.mp3'),
            spin: new Audio('https://www.soundjay.com/buttons/button-48.mp3'),
            coins: new Audio('https://www.soundjay.com/misc/sounds/coin-drop-1.mp3'),
            tick: new Audio('https://www.soundjay.com/buttons/button-50.mp3')
        };

        function playSound(key) {
            try {
                sounds[key].currentTime = 0;
                sounds[key].play();
            } catch(e) { console.log("Audio Bloqueado"); }
        }

        /* ============================================================
           N√öCLEO LOG√çSTICO Y PERSISTENCIA (DATABASE)
           ============================================================ */
        let db = JSON.parse(localStorage.getItem('blackvip_final_v1')) || {};
        let user = null;
        let isReg = false;

        function toggleAuth() {
            isReg = !isReg;
            document.getElementById('auth-main-title').innerText = isReg ? "MEMBRES√çA NUEVA" : "BLACK VIP CASINO";
            document.getElementById('reg-fields').style.display = isReg ? "block" : "none";
        }

        async function processAuth() {
    const u = document.getElementById('user-in').value.trim();
    const p = document.getElementById('pass-in').value.trim();
    const email = u + "@casino.com"; 

    if (isReg) {
        // REGISTRO
        const { data, error } = await supabase.auth.signUp({ email, password: p });
        if (error) return alert("Error: " + error.message);
        
        // Crear perfil en la tabla 'profiles'
        await supabase.from('profiles').insert([{ id: data.user.id, username: u, balance: 1000 }]);
        alert("¬°Cuenta VIP creada! Ahora inicia sesi√≥n.");
        toggleAuth(); 
    } else {
        // LOGIN
        const { data, error } = await supabase.auth.signInWithPassword({ email, password: p });
        if (error) return alert("Acceso denegado: Revisa usuario o clave.");
        
        window.currentUser = data.user;
        await loadUserData(); // Paso 4
        initVIP();
    }
}

        function initVIP() {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('vip-header').style.display = 'flex';
            document.getElementById('main-content').style.display = 'flex';
            document.getElementById('bank-info-display').innerText = "CUENTA DESTINO: " + db[user].bank;
            updateUI();
        }

        function save() { localStorage.setItem('blackvip_final_v1', JSON.stringify(db)); }

        function updateUI() {
            document.getElementById('bal-val').innerText = db[user].balance.toLocaleString();
            save();
            const h = document.getElementById('hist-body');
            if(h) {
                h.innerHTML = db[user].history.map(i => `
                    <tr>
                        <td style="font-weight:700">${i.game}</td>
                        <td>${i.bet} BC</td>
                        <td style="color:${i.res.includes('+') ? '#2e7d32' : '#d32f2f'}; font-weight:900">${i.res}</td>
                        <td>${i.time}</td>
                    </tr>
                `).join('');
            }
        }

        function addLog(game, bet, result) 
		function addLog(g, b, r) {
            db[user].history.unshift({ game: g, bet: b, res: r, time: new Date().toLocaleTimeString() });
            updateUI();
			syncBalance(balance);
        }

        /* ============================================================
           LOGICA: MODALES Y NAVEGACI√ìN
           ============================================================ */
        function openGame(id) { closeAll(); document.getElementById('modal-' + id).style.display = 'flex'; }
        function openBank() { closeAll(); document.getElementById('modal-bank').style.display = 'flex'; updateUI(); }
        function closeAll() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); clearInterval(aviatorInt); }

        /* ============================================================
           LOGICA MEJORADA: RULETA ROYAL (PRECIZI√ìN)
           ============================================================ */
        let spinning = false;

        function playR(choice) {
            if(spinning) return;
            if(db[user].balance < 50) return alert("Cr√©ditos insuficientes.");
            
            db[user].balance -= 50;
            updateUI();
            spinning = true;

            const wheel = document.getElementById('r-wheel');
            const status = document.getElementById('r-status');
            
            document.getElementById('r-btn-red').disabled = true;
            document.getElementById('r-btn-black').disabled = true;

            status.innerText = "¬°LA SUERTE EST√Å GIRANDO!";
            status.className = "status-msg";
            playSound('spin');

            const spins = 8 + Math.floor(Math.random() * 5);
            const extraDeg = Math.floor(Math.random() * 360);
            const totalDeg = (spins * 360) + extraDeg;

            wheel.style.transform = `rotate(${totalDeg}deg)`;

            let tickInt = setInterval(() => playSound('tick'), 300);

            setTimeout(() => {
                clearInterval(tickInt);
                spinning = false;
                document.getElementById('r-btn-red').disabled = false;
                document.getElementById('r-btn-black').disabled = false;

                const realAngle = totalDeg % 360;
                let colorFound;
                const needlePos = (360 - realAngle) % 360;

                if(needlePos >= 0 && needlePos <= 9.73) {
                    colorFound = 'verde';
                } else {
                    const segment = Math.floor((needlePos - 9.73) / 9.73);
                    colorFound = (segment % 2 === 0) ? 'rojo' : 'negro';
                }

                if(choice === colorFound) {
                    db[user].balance += 100;
                    status.innerText = "¬°VICTORIA VIP! +" + colorFound.toUpperCase();
                    status.classList.add('win-anim');
                    playSound('win');
                    addLog('Ruleta Royal', 50, '+100');
                } else {
                    status.innerText = "RESULTADO: " + colorFound.toUpperCase();
                    status.classList.add('lose-anim');
                    playSound('lose');
                    addLog('Ruleta Royal', 50, '-50');
                }
                updateUI();
            }, 8000); 
        }

        /* ============================================================
           LOGICA: BLACKJACK 21
           ============================================================ */
        let pHand = [], dHand = [];
        const vals = { '2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'10':10,'J':10,'Q':10,'K':10,'A':11 };

        function getCard() {
            const suits = ['‚ô†','‚ô£','‚ô•','‚ô¶'];
            const c = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            return c[Math.floor(Math.random() * c.length)];
        }

        function score(h) {
            let s = 0, a = 0;
            h.forEach(c => { s += vals[c]; if(c === 'A') a++; });
            while(s > 21 && a > 0) { s -= 10; a--; }
            return s;
        }

        function startB() {
            if(db[user].balance < 50) return alert("Saldo insuficiente.");
            db[user].balance -= 50;
            updateUI();

            pHand = [getCard(), getCard()];
            dHand = [getCard(), getCard()];

            document.getElementById('b-start').disabled = true;
            document.getElementById('b-hit').disabled = false;
            document.getElementById('b-stand').disabled = false;
            document.getElementById('b-status').innerText = "¬øOTRA O TE PLANTAS?";
            document.getElementById('b-status').className = "status-msg";
            
            playSound('card');
            renderB(false);
        }

        function renderB(all) {
            const pA = document.getElementById('b-player');
            const dA = document.getElementById('b-dealer');
            pA.innerHTML = pHand.map(c => `<div class="casino-card">${c}</div>`).join('');
            if(all) {
                dA.innerHTML = dHand.map(c => `<div class="casino-card" style="background:#eee">${c}</div>`).join('');
            } else {
                dA.innerHTML = `<div class="casino-card" style="background:#eee">${dHand[0]}</div><div class="casino-card" style="background:var(--purple-vip); color:transparent">?</div>`;
            }
        }

        function hitB() {
            pHand.push(getCard());
            playSound('card');
            renderB(false);
            if(score(pHand) > 21) endB("BUST: TE PASASTE", "-50");
        }

        function standB() {
            while(score(dHand) < 17) dHand.push(getCard());
            renderB(true);
            const ps = score(pHand), ds = score(dHand);
            if(ds > 21 || ps > ds) { db[user].balance += 100; endB("¬°GANASTE!", "+100"); }
            else if(ps === ds) { db[user].balance += 50; endB("EMPATE", "0"); }
            else endB("LA CASA GANA", "-50");
        }

        function endB(m, r) {
            const s = document.getElementById('b-status');
            s.innerText = m;
            s.className = r.includes('+') ? "status-msg win-anim" : "status-msg lose-anim";
            document.getElementById('b-start').disabled = false;
            document.getElementById('b-hit').disabled = true;
            document.getElementById('b-stand').disabled = true;
            addLog('Blackjack 21', 50, r);
            if(r.includes('+')) playSound('win'); else playSound('lose');
        }

        /* ============================================================
           LOGICA: POKER TEXAS HOLDEM (HEADS-UP)
           ============================================================ */
        let pokerDeck = [], pokerPlayer = [], pokerRival = [], pokerCommunity = [], pokerPot = 0, pokerPhase = 0;
        
        function initPokerDeck() {
            const s = ['‚ô†','‚ô£','‚ô•','‚ô¶'];
            const v = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            pokerDeck = [];
            s.forEach(suit => v.forEach(val => pokerDeck.push({val, suit})));
            pokerDeck.sort(() => Math.random() - 0.5);
        }

        function startP() {
            if(db[user].balance < 100) return alert("Saldo insuficiente.");
            db[user].balance -= 100;
            pokerPot = 200; 
            pokerPhase = 1; 
            initPokerDeck();
            
            pokerPlayer = [pokerDeck.pop(), pokerDeck.pop()];
            pokerRival = [pokerDeck.pop(), pokerDeck.pop()];
            pokerCommunity = [];
            
            document.getElementById('p-start').disabled = true;
            document.getElementById('p-call').disabled = false;
            document.getElementById('p-fold').disabled = false;
            document.getElementById('p-status').innerText = "RONDA: PRE-FLOP";
            renderP(false);
            updateUI();
        }

        function renderP(showRival) {
            const pHand = document.getElementById('p-player-hand');
            const rHand = document.getElementById('p-rival-hand');
            const cHand = document.getElementById('p-community');
            
            pHand.innerHTML = pokerPlayer.map(c => `<div class="casino-card" style="color:${(c.suit==='‚ô•'||c.suit==='‚ô¶')?'red':'black'}">${c.val}<small style="font-size:1rem; position:absolute; bottom:5px; right:5px;">${c.suit}</small></div>`).join('');
            
            if(showRival) {
                rHand.innerHTML = pokerRival.map(c => `<div class="casino-card" style="color:${(c.suit==='‚ô•'||c.suit==='‚ô¶')?'red':'black'}">${c.val}<small style="font-size:1rem; position:absolute; bottom:5px; right:5px;">${c.suit}</small></div>`).join('');
            } else {
                rHand.innerHTML = `<div class="casino-card" style="background:var(--purple-vip)"></div><div class="casino-card" style="background:var(--purple-vip)"></div>`;
            }
            
            cHand.innerHTML = pokerCommunity.map(c => `<div class="casino-card" style="color:${(c.suit==='‚ô•'||c.suit==='‚ô¶')?'red':'black'}">${c.val}<small style="font-size:1rem; position:absolute; bottom:5px; right:5px;">${c.suit}</small></div>`).join('');
            document.getElementById('p-pot').innerText = pokerPot;
        }

        function callP() {
            playSound('card');
            pokerPhase++;
            
            if(pokerPhase === 2) { 
                pokerCommunity.push(pokerDeck.pop(), pokerDeck.pop(), pokerDeck.pop());
                document.getElementById('p-status').innerText = "RONDA: EL FLOP";
            } else if(pokerPhase === 3) { 
                pokerCommunity.push(pokerDeck.pop());
                document.getElementById('p-status').innerText = "RONDA: EL TURN";
            } else if(pokerPhase === 4) { 
                pokerCommunity.push(pokerDeck.pop());
                document.getElementById('p-status').innerText = "RONDA FINAL: RIVER";
                document.getElementById('p-call').innerText = "MOSTRAR CARTAS";
            } else if(pokerPhase === 5) {
                endP();
            }
            renderP(false);
        }

        function foldP() {
            document.getElementById('p-status').innerText = "TE RETIRASTE";
            addLog('Poker VIP', 100, '-100');
            resetP();
        }

        function endP() {
            renderP(true);
            const pVal = Math.random() > 0.45; 
            if(pVal) {
                db[user].balance += pokerPot;
                document.getElementById('p-status').innerText = "¬°GANASTE EL BOTE!";
                document.getElementById('p-status').className = "status-msg win-anim";
                playSound('win');
                addLog('Poker VIP', 100, `+${pokerPot}`);
            } else {
                document.getElementById('p-status').innerText = "EL RIVAL GANA";
                document.getElementById('p-status').className = "status-msg lose-anim";
                playSound('lose');
                addLog('Poker VIP', 100, '-100');
            }
            resetP();
        }

        function resetP() {
            document.getElementById('p-start').disabled = false;
            document.getElementById('p-call').disabled = true;
            document.getElementById('p-fold').disabled = true;
            document.getElementById('p-call').innerText = "IGUALAR / PASAR";
            updateUI();
        }

        /* ============================================================
           LOGICA: AVIATOR PRO
           ============================================================ */
        let aviatorInt, curM = 1.0, flying = false;

        function startC() {
            if(db[user].balance < 100) return;
            db[user].balance -= 100;
            updateUI();
            flying = true; curM = 1.0;
            document.getElementById('c-start').disabled = true;
            document.getElementById('c-cash').disabled = false;
            document.getElementById('c-status').innerText = "EL AVI√ìN EST√Å ASCENDIENDO...";
            document.getElementById('c-status').className = "status-msg";

            let crash = 1.1 + (Math.random() * 4.5);

            aviatorInt = setInterval(() => {
                curM += 0.03;
                document.getElementById('c-mult').innerText = curM.toFixed(2) + "x";
                if(curM >= crash) {
                    clearInterval(aviatorInt); flying = false;
                    document.getElementById('c-status').innerText = "¬°EL AVI√ìN EXPLOT√ì!";
                    document.getElementById('c-status').className = "status-msg lose-anim";
                    playSound('lose');
                    addLog('Aviator Pro', 100, '-100');
                    document.getElementById('c-start').disabled = false;
                    document.getElementById('c-cash').disabled = true;
                }
            }, 100);
        }

        function cashC() {
            if(!flying) return;
            clearInterval(aviatorInt); flying = false;
            let w = Math.floor(100 * curM);
            db[user].balance += w;
            document.getElementById('c-status').innerText = "¬°COBRASTE " + w + " BC!";
            document.getElementById('c-status').className = "status-msg win-anim";
            playSound('coins');
            addLog('Aviator Pro', 100, '+' + w);
            document.getElementById('c-start').disabled = false;
            document.getElementById('c-cash').disabled = true;
        }

        /* ============================================================
           LOGICA: LUCKY SLOTS
           ============================================================ */
        function playS() {
            if(db[user].balance < 20) return;
            db[user].balance -= 20;
            updateUI();
            playSound('spin');
            document.getElementById('s-spin').disabled = true;

            const r = [document.getElementById('sl1'), document.getElementById('sl2'), document.getElementById('sl3')];
            const items = ['üçí','üíé','7Ô∏è‚É£','üîî','üçá','üçÄ'];

            let t = setInterval(() => {
                r.forEach(el => el.innerText = items[Math.floor(Math.random()*items.length)]);
            }, 100);

            setTimeout(() => {
                clearInterval(t);
                const res = r.map(el => {
                    let val = items[Math.floor(Math.random()*items.length)];
                    el.innerText = val; return val;
                });

                if(res[0] === res[1] && res[1] === res[2]) {
                    db[user].balance += 500;
                    document.getElementById('s-status').innerText = "¬°JACKPOT +500 BC!";
                    document.getElementById('s-status').className = "status-msg win-anim";
                    playSound('win');
                    addLog('Lucky Slots', 20, '+500');
                } else {
                    document.getElementById('s-status').innerText = "SUERTE PARA LA PR√ìXIMA";
                    addLog('Lucky Slots', 20, '-20');
                }
                document.getElementById('s-spin').disabled = false;
            }, 2000);
        }

        /* ============================================================
           LOGICA: MINAS VIP
           ============================================================ */
        let mPos = [], mFound = 0, mAct = false;

        function startM() {
            if(db[user].balance < 100) return;
            db[user].balance -= 100;
            updateUI();
            mAct = true; mFound = 0;
            mPos = Array(25).fill(false);
            let mCount = 0;
            while(mCount < 5) {
                let idx = Math.floor(Math.random() * 25);
                if(!mPos[idx]) { mPos[idx] = true; mCount++; }
            }

            const g = document.getElementById('m-grid');
            g.innerHTML = '';
            for(let i=0; i<25; i++) {
                let c = document.createElement('div');
                c.style = "width:100%; aspect-ratio:1; background:#222; border-radius:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:1.8rem; transition:0.3s; border:1px solid #333;";
                c.onclick = () => revealM(i, c);
                g.appendChild(c);
            }
            document.getElementById('m-start').disabled = true;
            document.getElementById('m-cash').disabled = false;
            document.getElementById('m-status').innerText = "MINAS COLOCADAS: 5";
        }

        function revealM(idx, el) {
            if(!mAct || el.innerText !== '') return;
            if(mPos[idx]) {
                el.innerText = 'üí£'; el.style.background = 'var(--red-casino)';
                mAct = false;
                document.getElementById('m-status').innerText = "¬°EXPLOSI√ìN!";
                document.getElementById('m-status').className = "status-msg lose-anim";
                playSound('lose');
                addLog('Minas VIP', 100, '-100');
                document.getElementById('m-start').disabled = false;
                document.getElementById('m-cash').disabled = true;
            } else {
                el.innerText = 'üíé'; el.style.background = 'var(--green-casino)';
                mFound++; playSound('card');
            }
        }

        function cashM() {
            if(!mAct) return;
            mAct = false;
            let w = Math.floor(100 * (1 + mFound * 0.8));
            db[user].balance += w;
            document.getElementById('m-status').innerText = "RECOLECTADO: " + w + " BC";
            document.getElementById('m-status').className = "status-msg win-anim";
            playSound('coins');
            addLog('Minas VIP', 100, '+' + w);
            document.getElementById('m-start').disabled = false;
            document.getElementById('m-cash').disabled = true;
        }

        function processWithdraw() {
            const v = parseInt(document.getElementById('wit-val').value);
            if(!v || v <= 0 || v > db[user].balance) return alert("Cantidad inv√°lida.");
            db[user].balance -= v;
            addLog('Liquidaci√≥n Cajero', v, 'PROCESANDO');
            alert("Su solicitud de retiro ha sido enviada con √©xito.");
        }

        /* ============================================================
           L√ìGICA NUEVA: TRUCO VENEZOLANO VIP (MOTOR INTEGRADO)
           ============================================================ */
        let tDeck = [], tHandP = [], tHandC = [], tVira = null;
        let tScoreP = 0, tScoreC = 0;
        let tTurn = 'P', tPlayedP = [], tPlayedC = [], tRoundsP = 0, tRoundsC = 0;

        function startTruco() {
            if(db[user].balance < 100) return alert("Saldo insuficiente.");
            db[user].balance -= 100;
            updateUI();
            tScoreP = 0; tScoreC = 0;
            document.getElementById('t-start').disabled = true;
            document.getElementById('t-btn-truco').disabled = false;
            document.getElementById('t-btn-envido').disabled = false;
            document.getElementById('t-btn-mazo').disabled = false;
            newHandTruco();
        }

        function newHandTruco() {
            const suits = ['Espadas', 'Bastos', 'Oros', 'Copas'];
            const valsT = ['1', '2', '3', '4', '5', '6', '7', '10', '11', '12'];
            tDeck = [];
            suits.forEach(s => valsT.forEach(v => tDeck.push({v, s})));
            tDeck.sort(() => Math.random() - 0.5);

            tVira = tDeck.pop();
            tHandP = [tDeck.pop(), tDeck.pop(), tDeck.pop()];
            tHandC = [tDeck.pop(), tDeck.pop(), tDeck.pop()];
            tPlayedP = []; tPlayedC = []; tRoundsP = 0; tRoundsC = 0;
            tTurn = 'P';
            renderTruco();
        }

        function renderTruco() {
            document.getElementById('t-vira').innerHTML = `${tVira.v}<small style="display:block; font-size:0.5rem">${tVira.s}</small>`;
            document.getElementById('t-score-p').innerText = tScoreP;
            document.getElementById('t-score-c').innerText = tScoreC;
            
            const hp = document.getElementById('t-hand-p');
            hp.innerHTML = '';
            tHandP.forEach((c, i) => {
                let div = document.createElement('div');
                div.className = 'casino-card';
                div.innerHTML = `${c.v}<small style="font-size:0.5rem">${c.s}</small>`;
                div.onclick = () => playCardTruco(i);
                hp.appendChild(div);
            });

            document.getElementById('t-hand-c').innerHTML = tHandC.map(() => `<div class="casino-card" style="background:var(--purple-vip)"></div>`).join('');
            document.getElementById('t-played-p').innerHTML = tPlayedP.length ? renderMiniCard(tPlayedP[tPlayedP.length-1]) : '';
            document.getElementById('t-played-c').innerHTML = tPlayedC.length ? renderMiniCard(tPlayedC[tPlayedC.length-1]) : '';
        }

        function renderMiniCard(c) {
            return `<div class="casino-card" style="background:white; color:black;">${c.v}<small style="display:block; font-size:0.5rem">${c.s}</small></div>`;
        }

        function playCardTruco(idx) {
            if(tTurn !== 'P') return;
            tPlayedP.push(tHandP.splice(idx, 1)[0]);
            playSound('card');
            renderTruco();
            tTurn = 'C';
            setTimeout(cpuTrucoMove, 1000);
        }

        function cpuTrucoMove() {
            if(tHandC.length > 0) {
                tPlayedC.push(tHandC.splice(0, 1)[0]);
                playSound('card');
                renderTruco();
                evalTrucoRound();
            }
        }

        function evalTrucoRound() {
            let pP = getPower(tPlayedP[tPlayedP.length-1]);
            let pC = getPower(tPlayedC[tPlayedC.length-1]);

            if(pP >= pC) {
                tRoundsP++;
                document.getElementById('t-status').innerText = "GANASTE LA MESA";
            } else {
                tRoundsC++;
                document.getElementById('t-status').innerText = "EL RIVAL GANA MESA";
            }

            if(tRoundsP === 2 || tRoundsC === 2 || tHandP.length === 0) {
                if(tRoundsP >= tRoundsC) tScoreP += 1; else tScoreC += 1;
                
                if(tScoreP >= 12) {
                    alert("¬°VICTORIA EN EL TRUCO! +300 BC");
                    db[user].balance += 300;
                    addLog('Truco Venezolano', 100, '+300');
                    document.getElementById('t-start').disabled = false;
                    updateUI();
                } else if(tScoreC >= 12) {
                    alert("DERROTA EN EL TRUCO");
                    addLog('Truco Venezolano', 100, '-100');
                    document.getElementById('t-start').disabled = false;
                    updateUI();
                } else {
                    setTimeout(newHandTruco, 1500);
                }
            } else {
                tTurn = 'P';
            }
        }

        function getPower(c) {
            // Manillas (Perico y Perica)
            if(c.v === '11' && c.s === tVira.s) return 100; // Perico
            if(c.v === '10' && c.s === tVira.s) return 90;  // Perica
            
            // Jerarqu√≠a base
            const p = {'1':14, '7':13, '3':12, '2':11, '12':10, '11':9, '10':8, '7':7, '6':6, '5':5, '4':4};
            let power = p[c.v] || 0;

            // Espadilla, Bastillo, etc.
            if(c.v === '1' && c.s === 'Espadas') return 50;
            if(c.v === '1' && c.s === 'Bastos') return 45;
            if(c.v === '7' && c.s === 'Espadas') return 40;
            if(c.v === '7' && c.s === 'Oros') return 35;

            return power;
        }

        function cantar(msg) {
            document.getElementById('t-status').innerText = "¬°CANTADO: " + msg.toUpperCase() + "!";
            playSound('coins');
            if(msg === 'truco') tScoreP += 2;
        }

        function irseAlMazo() {
            tScoreC += 1;
            newHandTruco();
			// NUEVA FUNCI√ìN: Trae el saldo real de la base de datos
async function loadUserData() {
    const { data, error } = await supabase
        .from('profiles')
        .select('balance')
        .eq('id', window.currentUser.id)
        .single();

    if (data) {
        balance = data.balance; // Actualizamos la variable global 'balance'
        updateUI(); // Refrescamos los n√∫meros en la pantalla
    }
}

// NUEVA FUNCI√ìN: Guarda el saldo cada vez que ganan o pierden
async function syncBalance(newBalance) {
    if (!window.currentUser) return;
    await supabase
        .from('profiles')
        .update({ balance: newBalance })
        .eq('id', window.currentUser.id);
}
        }
    </script>
</body>
</html>